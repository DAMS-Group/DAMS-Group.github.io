<!DOCTYPE html> <html lang="cn"> <head> <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"> <meta charset="utf-8"> <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"> <meta http-equiv="X-UA-Compatible" content="IE=edge"> <title> 第一章实验 | DAMS </title> <meta name="author" content=" "> <meta name="description" content="这篇文章主要介绍了如何搭建KVM虚拟化平台，包括安装Ubuntu Host系统、编译安装Linux内核、配置KVM支持、编译安装QEMU，以及如何创建和启动虚拟机。"> <link rel="stylesheet" href="/assets/css/bootstrap.min.css?a4b3f509e79c54a512b890d73235ef04"> <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/css/mdb.min.css" integrity="sha256-jpjYvU3G3N6nrrBwXJoVEYI/0zw8htfFnhT9ljN3JJw=" crossorigin="anonymous"> <link defer rel="stylesheet" href="/assets/css/academicons.min.css?f0b7046b84e425c55f3463ac249818f5"> <link defer rel="stylesheet" href="/assets/css/scholar-icons.css?62b2ac103a88034e6882a5be5f3e2772"> <link defer rel="stylesheet" type="text/css" href="https://fonts.googleapis.com/css?family=Roboto:300,400,500,700|Roboto+Slab:100,300,400,500,700|Material+Icons&amp;display=swap"> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-github.css?591dab5a4e56573bf4ef7fd332894c99" media="" id="highlight_theme_light"> <link rel="shortcut icon" href="/assets/img/icon.png?b4018dbfbd52d2e3cc004f2a590839cb"> <link rel="stylesheet" href="/assets/css/main.css?d41d8cd98f00b204e9800998ecf8427e"> <link rel="canonical" href="https://dams.net.cn/book/2025/lab1/"> <script src="/assets/js/theme.js?6ddb66544c57e17a63e7abf8cc6c43e3"></script> <link defer rel="stylesheet" href="/assets/css/jekyll-pygments-themes-native.css?5847e5ed4a4568527aa6cfab446049ca" media="none" id="highlight_theme_dark"> <script>
    initTheme();
  </script> </head> <body class="fixed-top-nav sticky-bottom-footer"> <header> <nav id="navbar" class="navbar navbar-light navbar-expand-sm fixed-top" role="navigation"> <div class="container"> <a class="navbar-brand title font-weight-lighter" href="/"> <img src="/assets/img/icon.png?b4018dbfbd52d2e3cc004f2a590839cb"> DAMS | 分布式与移动系统安全实验室 </a> <button class="navbar-toggler collapsed ml-auto" type="button" data-toggle="collapse" data-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation"> <span class="sr-only">Toggle navigation</span> <span class="icon-bar top-bar"></span> <span class="icon-bar middle-bar"></span> <span class="icon-bar bottom-bar"></span> </button> <div class="collapse navbar-collapse text-right" id="navbarNav"> <ul class="navbar-nav ml-auto flex-nowrap"> <li class="nav-item "> <a class="nav-link" href="/">首页 </a> </li> <li class="nav-item active"> <a class="nav-link" href="/book/">著作 </a> </li> <li class="nav-item "> <a class="nav-link" href="/publications/">论文 </a> </li> <li class="nav-item "> <a class="nav-link" href="/projects/">项目 </a> </li> <li class="nav-item "> <a class="nav-link" href="/members/">团队 </a> </li> <li class="nav-item "> <a class="nav-link" href="/news/">新闻 </a> </li> <li class="nav-item"> <button id="search-toggle" title="Search" onclick="openSearchModal()"> <span class="nav-link"> <i class="ti ti-search"></i> </span> </button> </li> <li class="toggle-container"> <button id="light-toggle" title="Change theme"> <i class="ti ti-sun-moon" id="light-toggle-system"></i> <i class="ti ti-moon-filled" id="light-toggle-dark"></i> <i class="ti ti-sun-filled" id="light-toggle-light"></i> </button> </li> </ul> </div> </div> </nav> <progress id="progress" value="0"> <div class="progress-container"> <span class="progress-bar"></span> </div> </progress> </header> <div class="container mt-5" role="main"> <div class="post"> <header class="post-header"> <h1 class="post-title">第一章实验</h1> <p class="post-meta"> Created in May 01, 2025 </p> <p class="post-tags"> <a href="/book/2025"> <i class="fa-solid fa-calendar fa-sm"></i> 2025 </a>   ·   <a href="/book/tag/qemu"> <i class="fa-solid fa-hashtag fa-sm"></i> QEMU</a>   <a href="/book/tag/kvm"> <i class="fa-solid fa-hashtag fa-sm"></i> KVM</a>   ·   <a href="/book/category/%E9%85%8D%E5%A5%97%E5%AE%9E%E9%AA%8C"> <i class="fa-solid fa-tag fa-sm"></i> 配套实验</a> </p> </header> <article class="post-content"> <div id="markdown-content"> <h1 id="实验一搭建-kvm-虚拟化平台">实验一：搭建 KVM 虚拟化平台</h1> <h2 id="安装-host-系统">安装 Host 系统</h2> <blockquote> <p>本小节为物理机安装 ubuntu 双系统说明，如采用 VMWare 等虚拟工作站方式作为运行环境可直接跳转下一小节。</p> </blockquote> <ul> <li> <p>Ubuntu 20.04 LTS 镜像</p> <ul> <li>下载地址：<a href="https://mirrors.tuna.tsinghua.edu.cn/ubuntu-releases/20.04/" rel="external nofollow noopener" target="_blank">清华源下载ubuntu-20.04.5-desktop-amd64.iso</a> </li> <li>20.04自带内核版本为 Linux5.15，与本书研究对象一致。</li> </ul> </li> <li> <p>制作U盘启动盘</p> <p>MacOS 系统可采用 <code class="language-plaintext highlighter-rouge">dd</code> 命令将U盘制作成 ubuntu 系统启动盘（windows 系统可采用 Rufus 工具）。</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>diskutil list
/dev/disk0 <span class="o">(</span>internal, physical<span class="o">)</span>:
   <span class="c">#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:      GUID_partition_scheme                        <span class="k">*</span>251.0 GB   disk0
   1:                        EFI EFI                     314.6 MB   disk0s1
   2:                 Apple_APFS Container disk1         250.7 GB   disk0s2

/dev/disk1 <span class="o">(</span>synthesized<span class="o">)</span>:
   <span class="c">#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:      APFS Container Scheme -                      +250.7 GB   disk1
                                 Physical Store disk0s2
   1:                APFS Volume Macintosh HD - 数据     188.9 GB   disk1s1
   2:                APFS Volume Preboot                 2.2 GB     disk1s2
   3:                APFS Volume Recovery                1.1 GB     disk1s3
   4:                APFS Volume VM                      8.6 GB     disk1s4
   5:                APFS Volume Macintosh HD            21.5 GB    disk1s5
   6:              APFS Snapshot com.apple.os.update-... 21.5 GB    disk1s5s1

/dev/disk2 <span class="o">(</span>external, physical<span class="o">)</span>:
   <span class="c">#:                       TYPE NAME                    SIZE       IDENTIFIER</span>
   0:     FDisk_partition_scheme                        <span class="k">*</span>7.8 GB     disk2
   1:             Windows_FAT_32 TESTONLY                7.8 GB     disk2s4

<span class="nv">$ </span>diskutil unmountDisk /dev/disk2
Unmount of all volumes on disk2 was successful
<span class="nv">$ </span><span class="nb">sudo dd </span><span class="k">if</span><span class="o">=</span>/Users/challenge/Downloads/ubuntu-20.04.5-desktop-amd64.iso <span class="nv">of</span><span class="o">=</span>/dev/rdisk2 <span class="nv">bs</span><span class="o">=</span>1m
Password:

3685+1 records <span class="k">in
</span>3685+1 records out
3864182784 bytes transferred <span class="k">in </span>625.176597 secs <span class="o">(</span>6180946 bytes/sec<span class="o">)</span>
</code></pre></div> </div> </li> <li> <p>安装双系统</p> <ul> <li>修改bios启动顺序 U盘优先（华硕主板开机界面按 F2 进入）</li> <li>进入ubuntu安装，选择新的硬盘即可</li> <li>重启拔掉U盘</li> </ul> </li> <li> <p>重启后可能会遇到死机进入grub命令界面</p> <ul> <li> <p>首先通过ls命令显示出硬盘分区信息，目的是找到boot/grub所在位置</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>grub&gt; <span class="nb">ls</span> <span class="o">(</span>h
Possible devices are:
hd0 hd1

grub› <span class="nb">ls</span> <span class="o">(</span>hd0,gpt
Possible partitions are:
	Partition hd0,gpt1: Filesystem <span class="nb">type </span>fat, UUID 890D-5C71 - Partition start at 1024K1B - Total size 524288KiB
	Partition hd0,gpt2: Filesystem <span class="nb">type </span>ext<span class="k">*</span> - Last modification <span class="nb">time </span>2023-03-23 09:33:27 Thursday, UUID 161f2ec0-a71c-4917-8abb-e4c558884663 - Partition start at 525312K1B - Total size 976236544KiB

grub&gt; <span class="nb">ls</span> <span class="o">(</span>hd0, gpt2<span class="o">)</span> /
Possible files are:
	lost+found/ boot/ swapfile etc/ media/ var/ bin/ dev/ home/ lib/ 11664/ mnt/ opt/ proc/ root/ run/ sbin/ snap/ srv/ sys/ tmp/ usr/ initrd.img initrd.img.old vmlinuz vmlinuz.old cdrom/ .cache/ lib32/ libx32/

grub&gt; <span class="nb">ls</span> <span class="o">(</span>hd0,gpt2<span class="o">)</span>/boot/grub/
Possible files are:
	gfxblacklist.txt unicode.pf2 x86_64-efi/ locale/ fonts/ grubenv grub.cfg
</code></pre></div> </div> </li> <li> <p>如上我们发现 (hd0, gpt2) / 下有boot/grub信息，再设置相应的入口</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>grub&gt; <span class="nb">set </span><span class="nv">root</span><span class="o">=(</span>hd0, gpt2<span class="o">)</span>
grub&gt; <span class="nb">set </span><span class="nv">prefix</span><span class="o">=(</span>hd0,gpt2<span class="o">)</span>/boot/grub
grub&gt; insmod normal
grub&gt; normal
</code></pre></div> </div> </li> <li> <p>然后便进入了系统选择页面，选择进入ubuntu20.04，再在终端命令行运行以下命令修复grub</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code>  <span class="nv">$ </span><span class="nb">sudo </span>update-grub
  <span class="o">[</span><span class="nb">sudo</span><span class="o">]</span> password <span class="k">for </span>chalnan:
  Sourcing file <span class="s1">'/etc/default/grub'</span>
  Sourcing file <span class="s1">'etc/default/grub.d/init-select.cfg'</span>
  Generating grub configuration file ...
  Found linux image: /boot/vmlinuz-5.15.0-67-generic
  Found initrd image: /boot/initrd.img-5.15.0-67-generic
  Found linux image: /boot/vmlinuz-5.15.0-60-generic
  Found initrd image: /boot/initrd.img-5.15.0-60-generic
  Found linux image: /boot/vmlinuz-5.15.0
  Found initrd image: /boot/initrd.img-5.15.0
  Found Ubuntu 18.04.5 LTS <span class="o">(</span>18.04<span class="o">)</span> on /dev/sda2
  Adding boot menu entry <span class="k">for </span>UEFI Firmware Settings
  <span class="k">done</span>
  <span class="nv">$ </span>lsblk
  NAME        MAJ:MIN RM   SIZE RO TYPE MOUNTPOINT
  sda           8:0    0 931.5G  0 disk
  ├─sda1        8:1    0   512M  0 part /boot/efi
  └─sda2        8:2    0   931G  0 part
  sr0          11:0    1  1024M  0 rom
  nvme0n1     259:0    0 931.5G  0 disk
  └─nvme0n1p1 259:1    0 931.5G  0 part /
  <span class="nv">$ </span><span class="nb">sudo </span>grub-install /dev/nvme0n1
  Installing <span class="k">for </span>x86_64-efi platform.
  Installation finished. No error reported.

</code></pre></div> </div> </li> <li> <p>重启后，可以正常引导启动进入ubuntu的图形界面系统。</p> </li> </ul> </li> </ul> <h2 id="源码编译安装-linux-内核">源码编译安装 Linux 内核</h2> <ul> <li><a href="https://mirrors.tuna.tsinghua.edu.cn/kernel/v5.x/linux-5.15.tar.gz" rel="external nofollow noopener" target="_blank">清华源下载linux-5.15.tar.gz</a></li> </ul> <h3 id="检查硬件系统支持">检查硬件系统支持</h3> <p>检查 CPU 是否支持 KVM 虚拟化。在 x86 和 x86-64 中，Intel 系列 CPU 支持虚拟化的标志为 vmx，AMD 系列 CPU 的标志为 svm ，如下命令行如有输出则表示 CPU 支持硬件虚拟化。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">grep</span> <span class="nt">-E</span> <span class="s1">'(vmx|svm)'</span> /proc/cpuinfo
</code></pre></div></div> <h3 id="配置内核">配置内核</h3> <p>安装基础开发工具软件包，该命令会安装一系列软件包，包括 <code class="language-plaintext highlighter-rouge">gcc</code>, <code class="language-plaintext highlighter-rouge">make</code>。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt update
<span class="nb">sudo </span>apt <span class="nb">install </span>build-essential
</code></pre></div></div> <p>安装 ncurses libraries、flex bison 依赖库</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt-get <span class="nb">install </span>ncurses-dev flex bison
</code></pre></div></div> <p>清空现有的配置文件</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make clean
make mrproper
</code></pre></div></div> <p>拷贝系统原生config文件 或者 调用默认配置文件生成config</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cp</span> /boot/config-5.15.0-70-generic .config
</code></pre></div></div> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make defconfig
</code></pre></div></div> <p>然后使用可视化的配置选项，检查/增加 KVM 支持</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make menuconfig
</code></pre></div></div> <p>选择 Virtualization ，选中 KVM 等支持，保存并退出。</p> <p>需要再检查一下证书相关的配置（不然之后 make 会报错）</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim .config
</code></pre></div></div> <p>检查 <code class="language-plaintext highlighter-rouge">CONFIG_SYSTEM_TRUSTED_KEYS</code> 和 <code class="language-plaintext highlighter-rouge">CONFIG_SYSTEM_REVOCATION_KEYS</code>的值是否为空值。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>原有值：
<span class="nv">CONFIG_SYSTEM_TRUSTED_KEYS</span><span class="o">=</span><span class="s2">"debian/canonical-certs.pem"</span>
<span class="nv">CONFIG_SYSTEM_REVOCATION_KEYS</span><span class="o">=</span><span class="s2">"debian/canonical-revoked-certs.pem"</span>
改为：
<span class="nv">CONFIG_SYSTEM_TRUSTED_KEYS</span><span class="o">=</span><span class="s2">""</span>
<span class="nv">CONFIG_SYSTEM_REVOCATION_KEYS</span><span class="o">=</span><span class="s2">""</span>
</code></pre></div></div> <h3 id="编译内核">编译内核</h3> <p>安装编译依赖</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>libssl-dev libelf-dev dwarves zstd
</code></pre></div></div> <p>编译 kernel，-j 参数表示并行编译，本机器逻辑 cpu 的数量为8，因此选择 -j8。逻辑 cpu 的数量可通过如下命令返回：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">cat</span> /proc/cpuinfo | <span class="nb">grep</span> <span class="s2">"processor"</span> |wc <span class="nt">-l</span>
</code></pre></div></div> <p>编译</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nt">-j8</span>
</code></pre></div></div> <h3 id="安装内核">安装内核</h3> <p>安装 module</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make modules_install
</code></pre></div></div> <p>以上命令将 module 安装到相应的目录中，默认情况下被安装到 <code class="language-plaintext highlighter-rouge">/lib/modules/$kernel_version/kernel</code> 目录之中，安装完之后可以查看 KVM 模块：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> /lib/modules/5.15.0/kernel/arch/x86/kvm/
</code></pre></div></div> <p>安装 kernel 和 initramfs</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nb">install</span>
</code></pre></div></div> <p>此时可见 <code class="language-plaintext highlighter-rouge">/boot</code> 目录下生成了内核（vmlinuz）和 initramfs 等内核启动所需的文件， grub 配置文件中自动添加了一个 grub 选项</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> /boot/
<span class="nb">cat</span> /boot/grub/grub.cfg |grep menuentry
</code></pre></div></div> <p>更改 grub 配置文件</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vim /etc/default/grub
<span class="c"># 注释掉GRUB_TIMEOUT_STYLE并将GRUB_TIMEOUT设置为10s</span>
<span class="c"># GRUB_TIMEOUT_STYLE=hidden</span>
<span class="nv">GRUB_TIMEOUT</span><span class="o">=</span>10
</code></pre></div></div> <p>接着使更改生效</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>update-grub
</code></pre></div></div> <p>重启，ubuntu选择界面中选择新安装的内核启动，查看当前内核版本</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">uname</span> <span class="nt">-a</span>
</code></pre></div></div> <p>查看 kvm 和 kvm_intel 两个模块是否加载</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>lsmod |grep kvm
<span class="c"># 如果没有就手动加载</span>
modprobe kvm
modprobe kvm_intel
</code></pre></div></div> <p>检查 <code class="language-plaintext highlighter-rouge">/dev/kvm</code> 文件，该文件是 KVM 内核模块提供给用户空间的 qemu-kvm 程序使用的一个控制接口</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">ls</span> <span class="nt">-l</span> /dev/kvm
</code></pre></div></div> <h3 id="单独编译-kvm-模块">单独编译 KVM 模块</h3> <p>进入 Linux 源码目录，执行以下命令单独编译 KVM 模块</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nt">-j8</span> <span class="nt">-C</span> <span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span> <span class="nv">M</span><span class="o">=</span><span class="sb">`</span><span class="nb">pwd</span><span class="sb">`</span>/arch/x86/kvm
rmmod kvm-intel
rmmod kvm
insmod <span class="nb">arch</span>/x86/kvm/kvm.ko
insmod <span class="nb">arch</span>/x86/kvm/kvm-intel.ko
</code></pre></div></div> <h2 id="源码编译安装-qemu">源码编译安装 QEMU</h2> <ul> <li><a href="https://download.qemu.org/qemu-4.0.0.tar.xz" rel="external nofollow noopener" target="_blank">官网下载源码qemu-4.0.0.tar.xz</a></li> </ul> <h3 id="配置-qemu">配置 QEMU</h3> <p>安装依赖库</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>libglib2.0-dev libpixman-1-dev
</code></pre></div></div> <p>创建 build 目录并配置支持 KVM 选项、目标架构名以及调试选项</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">mkdir </span>build
<span class="nb">cd </span>build
../configure <span class="nt">--enable-kvm</span> <span class="nt">--target-list</span><span class="o">=</span>x86_64-softmmu <span class="nt">--enable-debug</span>
</code></pre></div></div> <p>完成之后查看输出确保配置正确：</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>VNC support <span class="nb">yes</span> <span class="c"># 通常需要通过 VNC 连接到客户机中</span>
KVM support <span class="nb">yes</span> <span class="c"># 这是对 KVM 的支持</span>
</code></pre></div></div> <h3 id="编译安装-qemu">编译安装 QEMU</h3> <p>编译 QEMU， <code class="language-plaintext highlighter-rouge">make</code> 完成之后在 <code class="language-plaintext highlighter-rouge">build/x86_64-softmmu/</code> 目录下生成了可执行文件 <code class="language-plaintext highlighter-rouge">qemu-system-x86_64</code> 。执行 <code class="language-plaintext highlighter-rouge">make install</code> 将 QEMU 安装到 host 系统环境中。</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>make <span class="nt">-j8</span>
make <span class="nb">install</span>
</code></pre></div></div> <p>检查安装之后的系统状态</p> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>which qemu-system-x86_64
which qemu-img
</code></pre></div></div> <p>QEMU 是用户态的程序，不需要重启系统，直接用 <code class="language-plaintext highlighter-rouge">qemu-systemx86_64</code> 命令行工具即可启动虚拟机。</p> <h1 id="实验二创建并启动虚拟机">实验二：创建并启动虚拟机</h1> <h2 id="下载镜像">下载镜像</h2> <ul> <li>首先下载一个供虚拟机运行的镜像（本实例为 ubuntu.iso，读者可自行选择其他iso），并切换到存放镜像的路径下</li> </ul> <h2 id="创建磁盘文件">创建磁盘文件</h2> <ul> <li> <p>创建一个空的镜像文件来存储虚拟机的系统和文件（也可采用 <code class="language-plaintext highlighter-rouge">qemu-img</code> 命令）</p> <div class="language-bash highlighter-rouge"> <div class="highlight"><pre class="highlight"><code><span class="nb">dd </span><span class="k">if</span><span class="o">=</span>/dev/zero <span class="nv">of</span><span class="o">=</span>guest.img <span class="nv">bs</span><span class="o">=</span>1M <span class="nv">count</span><span class="o">=</span>40960
</code></pre></div> </div> <p><code class="language-plaintext highlighter-rouge">dd</code> 命令用于生成虚拟块设备文件。<code class="language-plaintext highlighter-rouge">if</code> 参数告诉 <code class="language-plaintext highlighter-rouge">dd</code> 从哪个文件读取数据， <code class="language-plaintext highlighter-rouge">of</code> 参数表示读出的数据写入哪个文件中。 <code class="language-plaintext highlighter-rouge">/dev/zero</code> 是 Linux 提供的一个特殊的字符设备，其每次读取的结果都是二进制0，可用于生成空镜像文件。<code class="language-plaintext highlighter-rouge">bs=1M</code> 表示每一次读写1M数据，<code class="language-plaintext highlighter-rouge">count=40960</code>表示读写 40960 次，这样就指定了生成文件的大小为40G。</p> </li> </ul> <h2 id="启动虚拟机">启动虚拟机</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code>qemu-system-x86_64 <span class="nt">-cpu</span> host <span class="nt">-smp</span> 1 <span class="nt">-m</span> 2048 <span class="nt">--enable-kvm</span> guest.img <span class="nt">-cdrom</span> ubuntu.iso
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">-cpu</code> 参数用于指定cpu类型和型号， <code class="language-plaintext highlighter-rouge">-smp</code> 参数用于cpu核数， <code class="language-plaintext highlighter-rouge">-m</code> 参数用于指定内存大小，<code class="language-plaintext highlighter-rouge">-cdrom</code> 参数用于指定要载入的镜像。</p> <h2 id="安装-gvncviewer-并连接虚拟机">安装 gvncviewer 并连接虚拟机</h2> <div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nb">sudo </span>apt <span class="nb">install </span>gvncviewer
gvncviewer 127.0.0.1::5900 <span class="c"># 默认情况 QEMU 开启5900端口</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">Ctrl+Alt+2</code> 切换到 QEMU 监视器窗口，可以执行 <code class="language-plaintext highlighter-rouge">info kvm</code> 命令来查看当前 QEMU 是否使用 KVM。<code class="language-plaintext highlighter-rouge">Ctrl+Alt+1</code> 切换回原窗口。</p> </div> </article> <div id="giscus_thread" style="max-width: 1600px; margin: 0 auto;"> <script>
      let giscusTheme = determineComputedTheme();
      let giscusAttributes = {
        src: 'https://giscus.app/client.js',
        'data-repo': 'DAMS-Group/DAMS-Group.github.io',
        'data-repo-id': 'R_kgDOOirvnQ',
        'data-category': 'Announcements',
        'data-category-id': 'DIC_kwDOOirvnc4Cpr6o',
        'data-mapping': 'title',
        'data-strict': '1',
        'data-reactions-enabled': '1',
        'data-emit-metadata': '0',
        'data-input-position': 'top',
        'data-theme': giscusTheme,
        'data-lang': 'zh-CN',
        'data-loading': 'lazy',
        crossorigin: 'anonymous',
        async: '',
      };

      let giscusScript = document.createElement('script');
      Object.entries(giscusAttributes).forEach(([key, value]) => giscusScript.setAttribute(key, value));
      document.getElementById('giscus_thread').appendChild(giscusScript);
    </script> <noscript>Please enable JavaScript to view the <a href="http://giscus.app/?ref_noscript" rel="external nofollow noopener" target="_blank">comments powered by giscus.</a> </noscript> </div> </div> </div> <footer class="fixed-bottom" role="contentinfo"> <div class="container mt-0"> © Copyright 2025. 分布式与移动系统安全实验室. All rights reserved. Last updated: May 17, 2025. </div> </footer> <script src="https://cdn.jsdelivr.net/npm/jquery@3.6.0/dist/jquery.min.js" integrity="sha256-/xUj+3OJU5yExlq6GSYGSHk7tPXikynS7ogEvDej/m4=" crossorigin="anonymous"></script> <script src="/assets/js/bootstrap.bundle.min.js"></script> <script src="https://cdn.jsdelivr.net/npm/mdbootstrap@4.20.0/js/mdb.min.js" integrity="sha256-NdbiivsvWt7VYCt6hYNT3h/th9vSTL4EDWeGs5SN3DA=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/masonry-layout@4.2.2/dist/masonry.pkgd.min.js" integrity="sha256-Nn1q/fx0H7SNLZMQ5Hw5JLaTRZp0yILA/FRexe19VdI=" crossorigin="anonymous"></script> <script defer src="https://cdn.jsdelivr.net/npm/imagesloaded@5.0.0/imagesloaded.pkgd.min.js" integrity="sha256-htrLFfZJ6v5udOG+3kNLINIKh2gvoKqwEhHYfTTMICc=" crossorigin="anonymous"></script> <script defer src="/assets/js/masonry.js?a0db7e5d5c70cc3252b3138b0c91dcaf" type="text/javascript"></script> <script defer src="https://cdn.jsdelivr.net/npm/medium-zoom@1.1.0/dist/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script> <script defer src="/assets/js/zoom.js?85ddb88934d28b74e78031fd54cf8308"></script> <script src="/assets/js/no_defer.js?2781658a0a2b13ed609542042a859126"></script> <script defer src="/assets/js/common.js?e0514a05c5c95ac1a93a8dfd5249b92e"></script> <script defer src="/assets/js/copy_code.js?12775fdf7f95e901d7119054556e495f" type="text/javascript"></script> <script defer src="/assets/js/jupyter_new_tab.js?d9f17b6adc2311cbabd747f4538bb15f"></script> <script async src="https://d1bxh8uas1mnw7.cloudfront.net/assets/embed.js"></script> <script async src="https://badge.dimensions.ai/badge.js"></script> <script defer type="text/javascript" id="MathJax-script" src="https://cdn.jsdelivr.net/npm/mathjax@3.2.2/es5/tex-mml-chtml.js" integrity="sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI=" crossorigin="anonymous"></script> <script src="/assets/js/mathjax-setup.js?a5bb4e6a542c546dd929b24b8b236dfd"></script> <script defer src="https://cdnjs.cloudflare.com/polyfill/v3/polyfill.min.js?features=es6" crossorigin="anonymous"></script> <script defer src="/assets/js/progress-bar.js?2f30e0e6801ea8f5036fa66e1ab0a71a" type="text/javascript"></script> <script src="/assets/js/vanilla-back-to-top.min.js?f40d453793ff4f64e238e420181a1d17"></script> <script>
    addBackToTop();
  </script> <script type="module" src="/assets/js/search/ninja-keys.min.js?a3446f084dcaecc5f75aa1757d087dcf"></script> <ninja-keys hidebreadcrumbs noautoloadmdicons placeholder="Type to start searching"></ninja-keys> <script src="/assets/js/search-setup.js?6c304f7b1992d4b60f7a07956e52f04a"></script> <script src="/assets/js/search-data.js"></script> <script src="/assets/js/shortcut-key.js?6f508d74becd347268a7f822bca7309d"></script> </body> </html>